<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Room Allocaton System | Boral Hall</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <link rel="shortcut icon" href="images/BAUET-Logo.png" type="image/x-icon" />

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

        :root {
            --clr-primary: #7380ec;
            --clr-primary-variant: #111e88;
            --clr-success: #41f1b6;
            --clr-danger: #000;
            --clr-warning: #d40c0c;
            --clr-white: #fff;
            --clr-dark: #000209;
            --clr-dark-variant: #677483;
            --clr-info-dark: #7d8da1;
            --clr-info-light: #dce1eb;
            --clr-light: rgba(132, 139, 200, 0.18);
            --clr-bg: #f6f6f9;
            --card-radius: 2rem;
            --radius-1: 0.4rem;
            --radius-2: 0.8rem;
            --radius-3: 1.2rem;
            --padding: 1.2rem;
            --card-padding: 1.8rem;
            --shadow: 0 2rem 3rem var(--clr-light);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            list-style: none;
            text-decoration: none;
        }

        .btn-primary {
            background: #111e88;
            color: #fff;
            border: none;
            border-radius: var(--radius-2);
            font-weight: 600;
            font-size: 1.1rem;
            padding: 0.6rem 2.2rem;
            box-shadow: 0 4px 16px 0 rgba(115, 128, 236, 0.10);
            position: relative;
            overflow: hidden;
            transition: background 0.4s color 0.2s, transform 0.2s;
            background-size: 200% 100%;
            background-position: left;
        }

        .btn-primary:hover {
            background-position: right;
            background: #020c65;
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 32px 0 rgba(115, 128, 236, 0.18);
            transition: background 0.4s color 0.2s, transform 0.2s;
        }

        .btn-success {
            background: #025a02;
            color: #fff;
            border: none;
        }

        .btn-danger {
            background: #d40c0c;
            color: #fff;
            border: none;
        }

        .btn-danger:hover {
            background: #7380ec;
            color: #fff;
            transform: scale(1.15) rotate(8deg);
            box-shadow: 0 8px 32px 0 rgba(212, 12, 12, 0.18);
        }

        @keyframes pop {
            0% {
                transform: scale(1) rotate(0deg);
            }

            50% {
                transform: scale(1.2) rotate(5deg);
            }

            100% {
                transform: scale(1.15);
            }
        }

        .card {
            transition: min-height 0.4s cubic-bezier(.4, 2, .6, 1), max-height 0.4s cubic-bezier(.4, 2, .6, 1), box-shadow 0.2s, transform 0.2s, padding 0.3s;
            overflow: hidden;
        }

        .card.expanded .card-body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            min-height: 320px;
            padding: 2rem 1rem;
        }

        .card.expanded form {
            width: 100%;
            max-width: 320px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .card.expanded form .form-control {
            width: 100%;
            text-align: center;
        }

        .card.expanded {
            min-height: 320px;
            max-height: 600px;
            padding-bottom: 2rem;
            box-shadow: 0 12px 36px 0 rgba(115, 128, 236, 0.22);
            transform: scale(1.03);
        }

        .layout-grid {
            display: grid;
            grid-template-columns: 14rem 1fr 5rem;
            min-height: 100vh;
            background: var(--clr-bg);
        }

        @media screen and (max-width: 1200px) {
            .container {
                padding-left: 7rem;
            }

            .aside {
                width: 7rem;
            }
        }

        @media (max-width: 900px) {
            .layout-grid {
                grid-template-columns: 1fr;
            }

            .right {
                position: static;
                width: 100%;
                margin-top: 0;
            }
        }

        main {
            grid-column: 2 / span 1;
            background: var(--clr-bg);
            border-radius: var(--radius-2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.10);
            padding: 2.5rem 2rem 2rem 2rem;
            margin: 2rem 0;
            min-height: 80vh;
            transition: background 0.3s;
            display: flex;
            flex-direction: column;
            align-items: stretch;
        }

        .main-title {
            margin-bottom: 2rem;
            font-size: 2rem;
            font-weight: 700;
            color: var(--clr-primary-variant);
            letter-spacing: 1px;
        }

        .filters-area {
            margin-bottom: 2rem;
        }

        .filter-row {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .filter-row>div {
            flex: 1 1 180px;
            min-width: 180px;
        }

        .seat-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 992px) {
            .seat-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .seat-grid {
                grid-template-columns: 1fr;
            }
        }

        .right {
            position: absolute;
            top: 0;
            right: 0;
            width: auto;
            z-index: 100;
            margin: 0.5rem 1rem;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: white;
            color: var(--clr-dark);
            font-size: 0.88rem;
            overflow-x: hidden;
            width: 100vw;
            height: 100vh;
        }

        h1 {
            font-size: 1.6rem;
        }

        h2 {
            font-size: 1.2rem;
        }

        h3 {
            font-size: 0.87rem;
        }

        h4 {
            font-size: 0.8rem;
        }

        h5 {
            font-size: 0.77rem;
        }

        p,
        small {
            color: var(--clr-dark-variant);
            text-align: justify;
        }

        b {
            color: var(--clr-dark);
        }

        .text-muted {
            color: var(--clr-info-dark);
        }

        .primary {
            color: var(--clr-primary);
        }

        .success {
            color: var(--clr-success);
        }

        .danger {
            color: var(--clr-danger);
            font-size: 2rem;
            font-weight: bold;
        }

        .warning {
            color: var(--clr-warning);
        }

        .rsm {
            font-size: 0.78rem;
            font-weight: 600;
            margin-left: 1rem;
            color: rgba(31, 31, 164, 0.996);
        }

        .container {
            display: grid;
            grid-template-columns: 14rem 1fr;
            gap: 1.8rem;
            margin: 0;
            padding-left: 2rem;
            width: 100%;
        }

        .aside {
            position: fixed;
            height: 100vh;
            width: 14rem;
            top: 0;
            left: 0;
            background: var(--clr-white);
            box-shadow: 2px 0 8px rgba(0, 0, 0, 0.1);
            z-index: 999;  
        }

        .filter-row {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 0.8rem;
            align-items: flex-start;

        }

        .filter-row>div {
            flex: 1 1 200px;
            min-width: 200px;
            margin-bottom: 0.5rem;
            display: flex;
            flex-direction: column;

        }

        .form-select,
        .form-control {
            margin-bottom: 0.5rem;

        }

        .text-center.mb-4 {
            margin-bottom: 2rem !important;

            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(115, 128, 236, 0.1);

        }

        .seat-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;

            margin-bottom: 1.5rem;
        }

        .card-body {
            padding: 1.25rem;
        }

        .filters-area {
            margin-bottom: 1rem;
        }

        main {
            padding: 2rem 1.8rem 1.8rem 1.8rem;
        }

        .form-select,
        .form-control {
            width: 100%;
            margin-bottom: 0.5rem;
        }

        .main-title {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.3rem;
            font-weight: 600;
            color: var(--clr-primary-variant);
            width: 100%;
        }

        .form-check {
            padding-bottom: 8px;
            margin-bottom: 0.5rem;
            margin-top: 1.6rem;
        }

        .filters-area {
            padding: 1.2rem;
            margin-bottom: 1rem;
        }

        .text-center.mb-4+.seat-grid {
            margin-top: 1.5rem;
        }

        .aside .top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem;
            border-bottom: 1px solid rgba(164, 158, 158, 0.1);
        }

        .aside .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .aside .logo h2 {
            font-size: 1.2rem;
        }

        .aside .top .close span {
            display: none;
            font-size: 2rem;
            cursor: pointer;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            padding-top: 1rem;
            height: 85vh;
        }

        .sidebar a {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            padding: 0.3rem;
            font-weight: 700;
            color: var(--clr-dark);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--radius-1);
            background: var(--clr-white);
            margin-bottom: 0.1rem;
            transition: background 0.2s, color 0.2s;
        }

        .sidebar a:hover {
            background: rgba(115, 128, 236, 0.1);
            color: var(--clr-primary);
        }

        .sidebar a.Active {
            background: var(--clr-light);
            border-left: 1px solid var(--clr-primary-variant);
            color: var(--clr-primary-variant);
        }

        .sidebar a span {
            font-size: 1.6rem;
            transition: margin 0.2s ease;
        }

        .sidebar a:hover span {
            margin-left: 0.25rem;
        }

        .about-container {
            background: var(--clr-white);
            border-radius: var(--radius-2);
            padding: var(--card-padding);
            box-shadow: var(--shadow);
            line-height: 1.6;
        }

        main .dashboard {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.8rem;
            margin-top: 1rem;
        }

        .about-grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
            align-items: start;
            margin-top: 1rem;
            padding: 1rem;
        }

        .about-image img {
            width: 100%;
            height: 100%;
            border-radius: var(--radius-2);
            margin-top: .4rem;
            border-radius: 10px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }

        .about-details p {
            text-align: justify;
            margin-bottom: 1rem;
        }

        @media screen and (max-width: 768px) {
            .container {
                padding-left: 0;
            }

            .aside {
                transform: translateX(-100%);
            }

            .aside.show {
                transform: translateX(0);
            }
        }

        .action-btn {
            margin-top: 0.8rem;
            padding: 0.4rem 1rem;
            border: none;
            border-radius: var(--radius-2);
            font-weight: 500;
            color: white;
            background: var(--clr-primary);
            cursor: pointer;
            transition: 0.2s ease;
        }

        .action-btn:hover {
            background: var(--clr-primary-variant);
        }

        .right {
            position: fixed;
            top: 0;
            right: 0;
            width: auto;
            z-index: 100;
            margin: 0.5rem 1rem;
        }

        .right .top {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            background: var(--clr-white);
            padding: 0.5rem;
            border-radius: var(--radius-1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            height: 3rem;
        }

        .logout-btn,
        .notification-btn {
            background: none;
            border: none;
            cursor: pointer;
            margin-top: .1rem;
            display: flex;
            font-size: 1rem;
            color: var(--clr-dark);
        }

        .logout-btn:hover {
            color: var(--clr-danger);
        }

        .profile-photo img {
            width: 2.4rem;
            height: 2.4rem;
            border-radius: 50%;
            object-fit: cover;
        }

        #menu_bar {
            display: none;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.5rem;
            color: var(--clr-dark);
        }

        @media screen and (max-width: 1200px) {
            .container {
                grid-template-columns: 7rem auto 14rem;
            }

            .sidebar h3 {
                display: inline;
            }

            main .dashboard {
                grid-template-columns: 1fr;
            }
        }

        @media screen and (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }

            #menu_bar {
                display: none;
                background: none;
                border: none;
                cursor: pointer;
                font-size: 1.5rem;
                color: var(--clr-dark);
            }

            .aside {
                position: fixed;
                top: 0;
                left: 0;
                width: 18rem;
                transform: translateX(-100%);
                z-index: 999;
                height: 100vh;
                box-shadow: 2px 0 12px rgba(0, 0, 0, 0.2);
            }

            .aside.show {
                transform: translateX(0);
            }

            .aside .top .close span {
                display: inline;
                position: absolute;
                top: 1rem;
                right: 1rem;
            }

            .right .top {
                position: fixed;
                background: white;
                top: 0;
                left: 0;
                width: 100%;
                padding: 0 1rem;
                z-index: 2;
            }

            .notification,
            .logout-btn {
                display: none;
            }

            main .dashboard {
                padding-top: 4rem;
                grid-template-columns: 1fr;
                gap: 1.6rem;
            }
        }

        @media (max-width: 1200px) {

            main,
            .right {
                grid-column: 2 / span 1;
            }
        }

        main {
            grid-column: 2 / span 1;
            background: var(--clr-bg);
            border-radius: var(--radius-2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.10);
            padding: 2.5rem 2rem 2rem 2rem;
            margin: 2rem 0;
            min-height: 80vh;
            transition: background 0.3s;
        }

        main h2 {
            font-size: 2rem;
            font-weight: 700;
            color: var(--clr-primary-variant);
            margin-bottom: 2rem;
            letter-spacing: 1px;
        }

        .form-label {
            font-weight: 600;
            color: var(--clr-primary-variant);
            margin-bottom: 0.5rem;
        }

        .form-select,
        .form-control {
            border-radius: var(--radius-2);
            border: 1.5px solid var(--clr-primary-variant);
            background: var(--clr-white);
            color: var(--clr-dark);
            font-size: 1rem;
            padding: 0.6rem 1rem;
            margin-bottom: 1rem;
            transition: border-color 0.2s;
        }

        .form-select:focus,
        .form-control:focus {
            border-color: var(--clr-primary);
            box-shadow: 0 0 0 2px var(--clr-light);
            outline: none;
        }

        .form-check-input:checked {
            background-color: var(--clr-primary);
            border-color: var(--clr-primary-variant);
        }

        .btn-primary {
            background: linear-gradient(90deg, var(--clr-primary), var(--clr-primary-variant));
            border: none;
            border-radius: var(--radius-2);
            font-weight: 600;
            font-size: 1.1rem;
            padding: 0.6rem 2.2rem;
            box-shadow: 0 4px 16px 0 rgba(115, 128, 236, 0.10);
            transition: background 0.2s, transform 0.2s;
        }

        .btn-primary:hover {
            background: linear-gradient(90deg, var(--clr-primary-variant), var(--clr-primary));
            transform: translateY(-2px) scale(1.03);
        }

        .seat-card .card {
            border-radius: var(--radius-2);
            box-shadow: 0 4px 24px 0 rgba(115, 128, 236, 0.08);
            border: none;
            background: var(--clr-white);
            transition: box-shadow 0.2s, transform 0.2s;
        }

        .seat-card .card:hover {
            box-shadow: 0 8px 32px 0 rgba(115, 128, 236, 0.18);
            transform: translateY(-4px) scale(1.02);
        }

        .card-title {
            color: var(--clr-primary-variant);
            font-weight: 700;
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        .btn-success,
        .btn-danger {
            border-radius: var(--radius-1);
            font-weight: 600;
            font-size: 1.2rem;
            padding: 0.4rem 1.2rem;
            box-shadow: 0 2px 8px 0 rgba(65, 241, 182, 0.10);
            transition: background 0.2s, transform 0.2s;
        }

        .btn-success:hover {
            background: #010c31;
            color: #fff;
            transform: scale(1.08);
        }

        .btn-danger:hover {
            background: #d40c0c;
            color: #fff;
            transform: scale(1.08);
        }

        .row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 992px) {
            .row {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .row {
                grid-template-columns: 1fr;
            }
        }

        .right .top button {
            margin: 0 0.6rem;
        }
    </style>
</head>

<body>
    <div class="container">
        <aside class="aside">
            <div class="top">
                <div class="logo">
                    <img src="images/BAUET-Logo.png" alt="Boral Hall Logo" style="width: 2.5rem; height: 2.5rem;">
                    <h2 class="danger" style="white-space: nowrap;">Boral Hall</h2>
                </div>
                <div class="close" title="Close Sidebar">
                    <span class="material-icons">close</span>
                </div>
            </div>

            <div class="sidebar">
                <a href="AdminDashboard.html"><span class="material-icons">dashboard</span>
                    <h3>Dashboard</h3>
                </a>
                <a href="#"><span class="material-icons">pending</span>
                    <h3>Check Request</h3>
                </a>
                <a href="#"><span class="material-icons">picture_as_pdf</span>
                    <h3>Add Documents</h3>
                </a>
                <a href="room.html" class="Active"><span class="material-icons">corporate_fare</span>
                    <h3>Room Allocation System</h3>
                </a>
                <a href="#"><span class="material-icons">search</span>
                    <h3>Searching Student Info</h3>
                </a>
                <a href="#"><span class="material-icons">co_present</span>
                    <h3>Attendance Report</h3>
                </a>
                <a href="#"><span class="material-icons">restaurant_menu</span>
                    <h3>Meal Report</h3>
                </a>
                <a href="complaints.html"><span class="material-icons">report</span>
                    <h3>Check Complaints</h3>
                </a>
                <a href="#"><span class="material-icons">logout</span>
                    <h3>Log Out</h3>
                </a>
                <p class="rsm">2025©️RSM</p>
            </div>
        </aside>

        <main>
            <h2 class="main-title text-center">Room Allocation System</h2>
            <div class="filters-area">
                <div class="filter-row">
                    <div>
                        <label for="floorSelect" class="form-label">Select Floor</label>
                        <select class="form-select" id="floorSelect" name="floor">
                            <option value="" disabled selected>Select Floor</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                        </select>
                    </div>
                    <div>
                        <label for="roomSelect" class="form-label">Select Room Number</label>
                        <select class="form-select" id="roomSelect" name="room">
                            <option value="" disabled selected>Select Room</option>

                            <option value="02">02</option>
                            <option value="03">03</option>
                            <option value="04">04</option>
                            <option value="05">05</option>
                            <option value="06">06</option>
                            <option value="07">07</option>
                            <option value="08">08</option>
                            <option value="09">09</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                        </select>
                    </div>

                    <div>
                        <label for="departmentSelect" class="form-label">Select Department</label>
                        <select class="form-select" id="departmentSelect" name="department">
                            <option value="" disabled selected>Select Department</option>
                            <option value="CSE">CSE</option>
                            <option value="EEE">EEE</option>
                            <option value="BBA">BBA</option>
                            <option value="CE">CE</option>
                            <option value="ME">ME</option>
                            <option value="ENG">ENG</option>
                            <option value="LAW">LAW</option>
                            <option value="ICE">ICE</option>
                        </select>
                    </div>
                    <div class="form-check" style="align-self: end;">
                        <input class="form-check-input" type="checkbox" id="availableSeat" name="availableSeat">
                        <label class="form-check-label" for="availableSeat">Available Seat</label>
                    </div>
                </div>


                <div class="text-center mb-4">
                    <button type="button" class="btn btn-primary">Filter</button>
                </div>
                <div class="seat-grid">
                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-body text-center">
                                <h5 class="card-title">Seat 1</h5>
                                <div id="seat1">
                                    <button class="btn btn-success" onclick="addPerson(1)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-body text-center">
                                <h5 class="card-title">Seat 2</h5>
                                <div id="seat2">
                                    <button class="btn btn-success" onclick="addPerson(2)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-body text-center">
                                <h5 class="card-title">Seat 3</h5>
                                <div id="seat3">
                                    <button class="btn btn-success" onclick="addPerson(3)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-body text-center">
                                <h5 class="card-title">Seat 4</h5>
                                <div id="seat4">
                                    <button class="btn btn-success" onclick="addPerson(4)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-body text-center">
                                <h5 class="card-title">Seat 5</h5>
                                <div id="seat5">
                                    <button class="btn btn-success" onclick="addPerson(5)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-body text-center">
                                <h5 class="card-title">Seat 6</h5>
                                <div id="seat6">
                                    <button class="btn btn-success" onclick="addPerson(6)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-center mt-4">
                <button type="submit" class="btn btn-primary">Submit</button>
            </div>

            <script>
                function addPerson(seatNumber) {
                    const seatDiv = document.getElementById(`seat${seatNumber}`);
                    const card = seatDiv.closest('.card');
                    if (card) card.classList.add('expanded');
                    seatDiv.innerHTML = `
                        <form>
                            <div class="mb-2">
                                <input type="text" class="form-control" placeholder="Name" name="name">
                            </div>
                            <div class="mb-2">
                                <input type="text" class="form-control" placeholder="ID" name="id">
                            </div>
                            <div class="mb-2">
                                <input type="text" class="form-control" placeholder="Department" name="department">
                            </div>
                            <div class="mb-2">
                                <input type="text" class="form-control" placeholder="Batch" name="batch">
                            </div>
                            <button type="button" class="btn btn-danger" onclick="removePerson(${seatNumber})">-</button>
                        </form>
                    `;
                }

                function removePerson(seatNumber) {
                    const seatDiv = document.getElementById(`seat${seatNumber}`);
                    const card = seatDiv.closest('.card');
                    if (card) card.classList.remove('expanded');
                    seatDiv.innerHTML = `
                        <button class="btn btn-success" onclick="addPerson(${seatNumber})">+</button>
                    `;
                }
            </script>
            <script src="assets/bootstrap/js/bootstrap.min.js"></script>
        </main>

        <div class="right">
            <div class="top">
                <button id="menu_bar" type="button">
                    <span class="material-icons">menu</span>
                </button>

                <button class="notification-btn" title="Notifications" type="button">
                    <span class="material-icons">notifications</span>
                </button>

                <button class="logout-btn" title="Logout" type="button">
                    <span class="material-icons">logout</span>
                </button>

                <div class="profile">
                    <div class="profile-photo" title="Profile">
                        <img src="assets/img/profile-user.png" alt="Profile Photo" />
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const menuBtn = document.getElementById('menu_bar');
            const sidebar = document.querySelector('.aside');
            const closeBtn = document.querySelector('.close span');

            if (menuBtn && sidebar) {
                menuBtn.addEventListener('click', () => {
                    sidebar.classList.add('show');
                });
            }

            if (closeBtn && sidebar) {
                closeBtn.addEventListener('click', () => {
                    sidebar.classList.remove('show');
                });
            }
        });
    </script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
        import { getFirestore, collection, doc, getDoc, getDocs, setDoc, query, where, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js";
        import { getAuth } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBF-nMMW5lG44JfHxx4HxCbf5N81geOiRs",
            authDomain: "bauet-hms-63f5b.firebaseapp.com",
            databaseURL: "https://bauet-hms-63f5b-default-rtdb.firebaseio.com",
            projectId: "bauet-hms-63f5b",
            storageBucket: "bauet-hms-63f5b.appspot.com",
            messagingSenderId: "200038506273",
            appId: "1:200038506273:web:2e141fc9ec36de049ae860"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let currentFloor = "";
        let currentRoom = "";
        let hasChanges = false;
        let roomData = null;  // Store room data for reuse

        // Remove the checkbox from HTML
        const availableSeatCheckbox = document.querySelector('.form-check');
        if (availableSeatCheckbox) {
            availableSeatCheckbox.remove();
        }

        // Create a section for Room Availability at the end of the page
        const main = document.querySelector('main');

        // Create room availability toggle button
        const roomInfoToggleBtn = document.createElement('button');
        roomInfoToggleBtn.className = 'btn btn-primary mt-4';
        roomInfoToggleBtn.style.display = 'block';
        roomInfoToggleBtn.style.margin = '2rem auto 1rem auto';
        roomInfoToggleBtn.textContent = 'Show Room Availability Status';
        roomInfoToggleBtn.id = 'roomInfoToggle';
        main.appendChild(roomInfoToggleBtn);

        // Create room availability section
        const roomInfoSection = document.createElement('div');
        roomInfoSection.id = 'roomInfoDisplay';
        roomInfoSection.style.margin = '1rem 0 2rem 0';
        roomInfoSection.style.display = 'none'; // Initially hidden
        roomInfoSection.style.padding = '1.5rem';
        roomInfoSection.style.backgroundColor = '#ffffff';
        roomInfoSection.style.borderRadius = '0.5rem';
        roomInfoSection.style.boxShadow = '0 4px 24px 0 rgba(115, 128, 236, 0.1)';
        main.appendChild(roomInfoSection);

        // Add event listener to toggle button
        roomInfoToggleBtn.addEventListener('click', () => {
            if (roomInfoSection.style.display === 'none') {
                roomInfoSection.style.display = 'block';
                roomInfoToggleBtn.textContent = 'Hide Room Availability Status';
                // Load room availability data if not already loaded
                if (!roomData) {
                    loadRoomAvailability();
                }
            } else {
                roomInfoSection.style.display = 'none';
                roomInfoToggleBtn.textContent = 'Show Room Availability Status';
            }
        });

        // Display loading message initially in hidden section
        roomInfoSection.innerHTML = `
        <h3 style="color:#7380ec;margin-bottom:0.5rem;">Room Availability Status</h3>
        <p>Click the button above to load room information.</p>
    `;

        // Cache for room existence and seat status to reduce Firebase calls
        const roomExistsCache = {};
        const roomSeatStatusCache = {};

        // Performance optimization: Batch-check room existence
        async function checkRoomExists(roomId) {
            if (roomExistsCache[roomId] !== undefined) {
                return roomExistsCache[roomId];
            }

            const roomDocRef = doc(db, "room", roomId);
            const roomDoc = await getDoc(roomDocRef);
            const exists = roomDoc.exists();
            roomExistsCache[roomId] = exists;
            return exists;
        }

        // Performance optimization: Cache room seat status
        async function getRoomSeatStatus(roomId) {
            if (roomSeatStatusCache[roomId] !== undefined) {
                return roomSeatStatusCache[roomId];
            }

            try {
                const roomDocRef = doc(db, "room", roomId);
                const membersCollectionRef = collection(roomDocRef, "members");
                const membersSnapshot = await getDocs(membersCollectionRef);

                let availableSeats = 0;
                let occupiedSeats = 0;
                let totalSeats = 0;
                let studentDetails = [];

                membersSnapshot.forEach(doc => {
                    totalSeats++;
                    const data = doc.data();
                    if (data.isEmpty === true) {
                        availableSeats++;
                    } else {
                        occupiedSeats++;
                        // Collect student details for detailed view
                        studentDetails.push({
                            seat: doc.id,
                            name: data.name || "",
                            id: data.id || "",
                            department: data.department || "",
                            batch: data.batch || ""
                        });
                    }
                });

                // If no members found, all seats are available
                if (totalSeats === 0) {
                    const result = { availableSeats: 6, occupiedSeats: 0, totalSeats: 6, studentDetails: [] };
                    roomSeatStatusCache[roomId] = result;
                    return result;
                }

                const result = { availableSeats, occupiedSeats, totalSeats, studentDetails };
                roomSeatStatusCache[roomId] = result;
                return result;
            } catch (error) {
                console.error("Error counting available seats:", error);
                return { availableSeats: 0, occupiedSeats: 0, totalSeats: 0, studentDetails: [] };
            }
        }

        // Function to get department count in a room
        async function getDepartmentCount(roomId, department) {
            try {
                // Use cached seat status if available
                if (roomSeatStatusCache[roomId]) {
                    const cache = roomSeatStatusCache[roomId];
                    return cache.studentDetails.filter(student =>
                        student.department.toLowerCase() === department.toLowerCase()
                    ).length;
                }

                const roomDocRef = doc(db, "room", roomId);
                const membersCollectionRef = collection(roomDocRef, "members");
                const membersSnapshot = await getDocs(membersCollectionRef);

                let departmentCount = 0;

                membersSnapshot.forEach(doc => {
                    const data = doc.data();
                    if (data.department && data.department.toLowerCase() === department.toLowerCase() && !data.isEmpty) {
                        departmentCount++;
                    }
                });

                return departmentCount;
            } catch (error) {
                console.error("Error counting department members:", error);
                return 0;
            }
        }

        // Function to load room availability - called when button is clicked
        async function loadRoomAvailability() {
            // Only load if not already loaded
            if (roomData) {
                displayRoomAvailability(
                    roomData.availableRooms,
                    roomData.fullyOccupiedRooms,
                    roomData.nonExistentRooms,
                    roomData.totalStats
                );
                return;
            }

            roomInfoSection.innerHTML = `
            <h3 style="color:#7380ec;margin-bottom:0.5rem;">Room Availability Status</h3>
            <p>Loading room information... Please wait.</p>
            <div style="width:100%;height:6px;background:#f0f0f0;border-radius:3px;margin-top:0.5rem;overflow:hidden;">
                <div id="loadingBar" style="width:0%;height:100%;background:#7380ec;border-radius:3px;transition:width 0.3s;"></div>
            </div>
        `;

            try {
                roomData = await getRoomAvailability();
                displayRoomAvailability(
                    roomData.availableRooms,
                    roomData.fullyOccupiedRooms,
                    roomData.nonExistentRooms,
                    roomData.totalStats
                );
            } catch (error) {
                console.error("Error loading room data:", error);
                roomInfoSection.innerHTML = `
                <h3 style="color:#7380ec;margin-bottom:0.5rem;">Room Availability Status</h3>
                <p style="color:#dc3545;">Error loading room data. Please try again.</p>
                <button class="btn btn-sm btn-outline-primary mt-2" onclick="document.getElementById('roomInfoToggle').click(); setTimeout(() => document.getElementById('roomInfoToggle').click(), 100);">Retry</button>
            `;
            }
        }

        // Function to get all room information with chunking for better UX
        async function getRoomAvailability() {
            const availableRooms = [];
            const fullyOccupiedRooms = [];
            const nonExistentRooms = [];

            // All student data for detailed view
            const allStudents = [];

            // Total counters
            let totalOccupiedSeats = 0;
            let totalAvailableSeats = 0;

            // Get all floors and rooms from the dropdowns
            const floors = Array.from(document.getElementById('floorSelect').options)
                .filter(option => option.value)
                .map(option => option.value);

            const rooms = Array.from(document.getElementById('roomSelect').options)
                .filter(option => option.value)
                .map(option => option.value);

            // Create combined list of all possible rooms
            const allPossibleRooms = [];
            for (const floor of floors) {
                for (const room of rooms) {
                    allPossibleRooms.push({ floor, room });
                }
            }

            // Calculate chunk size (process rooms in batches for better UX)
            const totalRooms = allPossibleRooms.length;
            const chunkSize = 10; // Process 10 rooms at a time

            // Process rooms in chunks
            for (let i = 0; i < allPossibleRooms.length; i += chunkSize) {
                const chunk = allPossibleRooms.slice(i, i + chunkSize);

                // Process all rooms in current chunk in parallel
                const chunkPromises = chunk.map(async ({ floor, room }) => {
                    const roomId = `${floor}${room}`;
                    const exists = await checkRoomExists(roomId);

                    if (exists) {
                        const seatStatus = await getRoomSeatStatus(roomId);

                        // Update global counters
                        totalOccupiedSeats += seatStatus.occupiedSeats;
                        totalAvailableSeats += seatStatus.availableSeats;

                        // Add student details to all students array
                        seatStatus.studentDetails.forEach(student => {
                            allStudents.push({
                                ...student,
                                room: roomId,
                                floor: floor,
                                roomNumber: room
                            });
                        });

                        if (seatStatus.availableSeats > 0) {
                            return {
                                type: 'available',
                                roomId,
                                floor,
                                room,
                                availableSeats: seatStatus.availableSeats,
                                occupiedSeats: seatStatus.occupiedSeats,
                                totalSeats: seatStatus.totalSeats
                            };
                        } else {
                            return {
                                type: 'occupied',
                                roomId,
                                floor,
                                room,
                                occupiedSeats: seatStatus.occupiedSeats,
                                totalSeats: seatStatus.totalSeats
                            };
                        }
                    } else {
                        // Non-existent rooms also count as available (with 6 seats)
                        totalAvailableSeats += 6;

                        return {
                            type: 'nonexistent',
                            roomId,
                            floor,
                            room
                        };
                    }
                });

                const results = await Promise.all(chunkPromises);

                // Sort results into appropriate arrays
                results.forEach(result => {
                    if (result.type === 'available') {
                        availableRooms.push(result);
                    } else if (result.type === 'occupied') {
                        fullyOccupiedRooms.push(result);
                    } else if (result.type === 'nonexistent') {
                        nonExistentRooms.push(result);
                    }
                });

                // Update progress bar
                const progressPercent = Math.min(100, Math.round(((i + chunk.length) / totalRooms) * 100));
                const loadingBar = document.getElementById('loadingBar');
                if (loadingBar) {
                    loadingBar.style.width = `${progressPercent}%`;
                }
            }

            // Sort rooms by floor and room number
            const sortRooms = (a, b) => {
                if (a.floor !== b.floor) {
                    return parseInt(a.floor) - parseInt(b.floor);
                }
                return parseInt(a.room) - parseInt(b.room);
            };

            availableRooms.sort(sortRooms);
            fullyOccupiedRooms.sort(sortRooms);
            nonExistentRooms.sort(sortRooms);

            return {
                availableRooms,
                fullyOccupiedRooms,
                nonExistentRooms,
                allStudents,
                totalStats: {
                    totalOccupiedSeats,
                    totalAvailableSeats
                }
            };
        }

        // Function to display room availability information
        function displayRoomAvailability(availableRooms, fullyOccupiedRooms, nonExistentRooms, totalStats) {
            let html = `<h3 style="color:#7380ec;margin-bottom:0.5rem;">Room Availability Status</h3>`;

            // Summary stats
            const totalRooms = availableRooms.length + fullyOccupiedRooms.length + nonExistentRooms.length;
            const existingRooms = availableRooms.length + fullyOccupiedRooms.length;

            // Combine non-existent and available numbers
            const totalAvailableRooms = availableRooms.length + nonExistentRooms.length;

            html += `
            <div style="margin-bottom:1rem;display:flex;flex-wrap:wrap;gap:1rem;">
                <div style="flex:1;min-width:200px;padding:0.8rem;background:#e8f5e9;border-radius:0.4rem;">
                    <strong>Available Rooms:</strong> ${totalAvailableRooms}
                    <div style="font-size:0.8rem;margin-top:0.3rem;">
                        <span>In Database: ${availableRooms.length}</span> • 
                        <span>Not Created: ${nonExistentRooms.length}</span>
                    </div>
                </div>
                <div style="flex:1;min-width:200px;padding:0.8rem;background:#fff3cd;border-radius:0.4rem;">
                    <strong>Full Rooms:</strong> ${fullyOccupiedRooms.length}
                </div>
            </div>
            
            <div style="margin-bottom:1.5rem;display:flex;flex-wrap:wrap;gap:1rem;">
                <div style="flex:1;min-width:200px;padding:0.8rem;background:#e3f2fd;border-radius:0.4rem;">
                    <strong>Occupied Seats:</strong> ${totalStats.totalOccupiedSeats}
                    <div style="font-size:0.8rem;margin-top:0.3rem;">Students currently living in the hall</div>
                </div>
                <div style="flex:1;min-width:200px;padding:0.8rem;background:#f3e5f5;border-radius:0.4rem;">
                    <strong>Available Seats:</strong> ${totalStats.totalAvailableSeats}
                    <div style="font-size:0.8rem;margin-top:0.3rem;">Including seats in non-existent rooms</div>
                </div>
            </div>
        `;

            // Display rooms with available seats (including non-existent rooms)
            const combinedAvailableRooms = [...availableRooms, ...nonExistentRooms.map(room => ({
                ...room,
                availableSeats: 6,
                occupiedSeats: 0,
                totalSeats: 6,
                notInDatabase: true
            }))];

            if (combinedAvailableRooms.length > 0) {
                html += `<h4 style="margin-top:1rem;margin-bottom:0.5rem;">Rooms with Available Seats:</h4>`;
                html += `<div style="display:grid;grid-template-columns:repeat(auto-fill, minmax(200px, 1fr));gap:0.7rem;">`;

                combinedAvailableRooms.forEach(room => {
                    const backgroundColor = room.notInDatabase ? '#e8f5e9' : '#e6f7ff';
                    const borderColor = room.notInDatabase ? '#0ba31d' : '#007bff';
                    const statusText = room.notInDatabase ?
                        `<div style="color:#4bcf1b;font-size:0.8rem;">Not in database yet</div>` :
                        `<div style="color:#007bff;font-size:0.8rem;">In database</div>`;

                    html += `
                    <div style="background-color:${backgroundColor};padding:0.8rem;border-radius:0.3rem;border-left:3px solid ${borderColor};cursor:pointer;"
                         onclick="selectRoom('${room.floor}', '${room.room}')">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <strong>Room ${room.floor}${room.room}</strong>
                            <span style="background:${room.notInDatabase ? '#0ba31d' : '#007bff'};color:white;font-size:0.7rem;padding:0.1rem 0.4rem;border-radius:0.2rem;">
                                Floor ${room.floor}
                            </span>
                        </div>
                        ${statusText}
                        <div style="margin-top:0.5rem;display:flex;justify-content:space-between;">
                            <span>Available: <strong>${room.availableSeats}</strong></span>
                            <span>Occupied: <strong>${room.occupiedSeats}</strong></span>
                        </div>
                        <div style="height:4px;width:100%;background:#ddd;margin-top:0.4rem;border-radius:2px;">
                            <div style="height:100%;width:${(room.occupiedSeats / (room.totalSeats || 6)) * 100}%;background:${room.notInDatabase ? '#fd7e14' : '#007bff'};border-radius:2px;"></div>
                        </div>
                    </div>
                `;
                });

                html += `</div>`;
            }

            // Display fully occupied rooms
            if (fullyOccupiedRooms.length > 0) {
                html += `<h4 style="margin-top:1.5rem;margin-bottom:0.5rem;">Fully Occupied Rooms:</h4>`;
                html += `<div style="display:grid;grid-template-columns:repeat(auto-fill, minmax(180px, 1fr));gap:0.7rem;">`;

                fullyOccupiedRooms.forEach(room => {
                    html += `
                    <div style="background-color:#f8d7da;padding:0.8rem;border-radius:0.3rem;border-left:3px solid #dc3545;cursor:pointer;"
                         onclick="selectRoom('${room.floor}', '${room.room}')">
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <strong>Room ${room.floor}${room.room}</strong>
                            <span style="background:#dc3545;color:white;font-size:0.7rem;padding:0.1rem 0.4rem;border-radius:0.2rem;">
                                Full
                            </span>
                        </div>
                        <div style="margin-top:0.5rem;">
                            <span>Occupied: <strong>${room.occupiedSeats}/${room.totalSeats}</strong></span>
                        </div>
                        <div style="height:4px;width:100%;background:#ddd;margin-top:0.4rem;border-radius:2px;">
                            <div style="height:100%;width:100%;background:#dc3545;border-radius:2px;"></div>
                        </div>
                    </div>
                `;
                });

                html += `</div>`;
            }

            roomInfoSection.innerHTML = html;
        }

        // Function to display department concentration info
        function displayDepartmentRoomInfo(department, departmentRooms) {
            roomInfoSection.style.display = 'block';
            roomInfoToggleBtn.textContent = 'Hide Room Availability Status';

            if (departmentRooms.length === 0) {
                roomInfoSection.innerHTML = `
                <h3 style="color:#7380ec;margin-bottom:0.5rem;">Department Room Information</h3>
                <p>No rooms found with students from the ${department} department.</p>
            `;
                return;
            }

            // Group rooms by count of department students for better visualization
            const groupedRooms = {};
            departmentRooms.forEach(room => {
                if (!groupedRooms[room.departmentCount]) {
                    groupedRooms[room.departmentCount] = [];
                }
                groupedRooms[room.departmentCount].push(room);
            });

            let html = `
            <h3 style="color:#7380ec;margin-bottom:0.5rem;">Department Room Information</h3>
            <p>Rooms with <strong>${department}</strong> department students (sorted by highest count):</p>
        `;

            // Get all keys (counts) and sort them in descending order
            const counts = Object.keys(groupedRooms).map(Number).sort((a, b) => b - a);

            // Display rooms organized by count
            counts.forEach(count => {
                html += `
                <h4 style="margin-top:1rem;margin-bottom:0.5rem;">
                    Rooms with ${count} ${department} student${count !== 1 ? 's' : ''}:
                </h4>
                <div style="display:grid;grid-template-columns:repeat(auto-fill, minmax(150px, 1fr));gap:0.5rem;">
            `;

                groupedRooms[count].forEach(room => {
                    html += `
                    <div style="background-color:#e8f5e9;padding:0.5rem;border-radius:0.3rem;border-left:3px solid #28a745;cursor:pointer;"
                         onclick="selectRoom('${room.floor}', '${room.room}')">
                        <strong>Room ${room.floor}${room.room}</strong>
                    </div>
                `;
                });

                html += `</div>`;
            });

            roomInfoSection.innerHTML = html;
        }

        // Handle filter button click
        document.querySelector('.filters-area .btn-primary').addEventListener('click', async function () {
            const floor = document.getElementById('floorSelect').value;
            const room = document.getElementById('roomSelect').value;
            const department = document.getElementById('departmentSelect').value;

            // If both floor and room are selected, load that specific room
            if (floor && room) {
                currentFloor = floor;
                currentRoom = room;
                hasChanges = false;

                try {
                    const roomId = `${floor}${room}`;
                    const roomDocRef = doc(db, "room", roomId);
                    const roomDoc = await getDoc(roomDocRef);

                    if (!roomDoc.exists()) {
                        // Create the room in the database
                        await setDoc(roomDocRef, {
                            floor: floor,
                            roomNumber: room,
                            createdAt: new Date(),
                            lastUpdated: new Date()
                        });

                        // Create 6 empty seats for the new room
                        const batch = writeBatch(db);
                        for (let seatNum = 1; seatNum <= 6; seatNum++) {
                            const seatId = `seat${seatNum}`;
                            const seatDocRef = doc(db, "room", roomId, "members", seatId);
                            batch.set(seatDocRef, {
                                name: "",
                                id: "",
                                department: "",
                                batch: "",
                                isEmpty: true
                            });
                        }
                        await batch.commit();

                        // Clear room cache
                        delete roomExistsCache[roomId];
                        delete roomSeatStatusCache[roomId];

                        console.log(`Created new room: ${roomId}`);
                    }
                    // Now check for members
                    const membersCollectionRef = collection(roomDocRef, "members");
                    const membersSnapshot = await getDocs(membersCollectionRef);
                    const membersExist = !membersSnapshot.empty;

                    for (let i = 1; i <= 6; i++) {
                        removePerson(i);
                    }
                    if (membersExist) {
                        for (let seatNum = 1; seatNum <= 6; seatNum++) {
                            const seatId = `seat${seatNum}`;
                            const seatDocRef = doc(db, "room", roomId, "members", seatId);
                            const seatDoc = await getDoc(seatDocRef);
                            if (seatDoc.exists()) {
                                const studentData = seatDoc.data();
                                if (!department || studentData.department === department) {
                                    populateSeat(seatNum, studentData);
                                }
                            }
                        }
                    }
                } catch (error) {
                    console.error("Error fetching/creating room data:", error);
                    alert("Failed to fetch or create room data. Please try again.");
                }
            }
            // Feature: Department Concentration - Only department is selected
            // Feature: Department Concentration - Only department is selected
            else if (department && !floor && !room) {
                // Clear seat display
                for (let i = 1; i <= 6; i++) {
                    removePerson(i);
                }

                // Show department information in the room info section
                roomInfoSection.innerHTML = `
            <h3 style="color:#7380ec;margin-bottom:0.5rem;">Department Room Information</h3>
            <p>Searching for ${department} department students... This may take a moment.</p>
            <div style="width:100%;height:6px;background:#f0f0f0;border-radius:3px;margin-top:0.5rem;overflow:hidden;">
                <div id="depLoadingBar" style="width:0%;height:100%;background:#7380ec;border-radius:3px;transition:width 0.3s;"></div>
            </div>
        `;
                roomInfoSection.style.display = 'block';
                roomInfoToggleBtn.textContent = 'Hide Room Availability Status';

                const departmentRooms = await findDepartmentConcentration(department);
                displayDepartmentRoomInfo(department, departmentRooms);
            }
            else {
                alert("Please select both floor and room number, or select a department to see concentration.");
            }
        });

        // Function to find rooms with highest concentration of a department
        async function findDepartmentConcentration(department) {
            const departmentRooms = [];

            // Get all floors and rooms from the dropdowns
            const floors = Array.from(document.getElementById('floorSelect').options)
                .filter(option => option.value)
                .map(option => option.value);

            const rooms = Array.from(document.getElementById('roomSelect').options)
                .filter(option => option.value)
                .map(option => option.value);

            // Create combined list of all possible rooms
            const allPossibleRooms = [];
            for (const floor of floors) {
                for (const room of rooms) {
                    allPossibleRooms.push({ floor, room });
                }
            }

            // Calculate chunk size (process rooms in batches for better UX)
            const totalRooms = allPossibleRooms.length;
            const chunkSize = 10; // Process 10 rooms at a time

            // Process rooms in chunks
            for (let i = 0; i < allPossibleRooms.length; i += chunkSize) {
                const chunk = allPossibleRooms.slice(i, i + chunkSize);

                // Process all rooms in current chunk in parallel
                const chunkPromises = chunk.map(async ({ floor, room }) => {
                    const roomId = `${floor}${room}`;
                    const exists = await checkRoomExists(roomId);

                    if (exists) {
                        const departmentCount = await getDepartmentCount(roomId, department);
                        if (departmentCount > 0) {
                            return {
                                roomId,
                                floor,
                                room,
                                departmentCount
                            };
                        }
                    }
                    return null;
                });

                const results = await Promise.all(chunkPromises);

                // Filter out null results and add valid ones to departmentRooms
                results.filter(Boolean).forEach(room => departmentRooms.push(room));

                // Update progress bar
                const progressPercent = Math.min(100, Math.round(((i + chunk.length) / totalRooms) * 100));
                const loadingBar = document.getElementById('depLoadingBar');
                if (loadingBar) {
                    loadingBar.style.width = `${progressPercent}%`;
                }
            }

            // Sort by department count (highest first)
            departmentRooms.sort((a, b) => b.departmentCount - a.departmentCount);

            return departmentRooms;
        }

        // Function to select a specific room from the info cards
        window.selectRoom = function (floor, room) {
            const floorSelect = document.getElementById('floorSelect');
            const roomSelect = document.getElementById('roomSelect');

            // Set the dropdown values
            for (let i = 0; i < floorSelect.options.length; i++) {
                if (floorSelect.options[i].value === floor) {
                    floorSelect.selectedIndex = i;
                    break;
                }
            }

            for (let i = 0; i < roomSelect.options.length; i++) {
                if (roomSelect.options[i].value === room) {
                    roomSelect.selectedIndex = i;
                    break;
                }
            }

            // Trigger the filter button click to load the room data
            document.querySelector('.filters-area .btn-primary').click();
        };

        // Fix the populateSeat function

        window.populateSeat = function (seatNumber, studentData) {
            const seatDiv = document.getElementById(`seat${seatNumber}`);
            const card = seatDiv.closest('.card');
            if (card) card.classList.add('expanded');

            // Check if this seat should be empty or not
            if (studentData && !studentData.isEmpty) {
                seatDiv.innerHTML = `
            <form>
                <div class="mb-2">
                    <input type="text" class="form-control" placeholder="Name" name="name" value="${studentData.name || ''}">
                </div>
                <div class="mb-2">
                    <input type="text" class="form-control" placeholder="ID" name="id" value="${studentData.id || ''}">
                </div>
                <div class="mb-2">
                    <input type="text" class="form-control" placeholder="Department" name="department" value="${studentData.department || ''}">
                </div>
                <div class="mb-2">
                    <input type="text" class="form-control" placeholder="Batch" name="batch" value="${studentData.batch || ''}">
                </div>
                <button type="button" class="btn btn-danger" onclick="removePerson(${seatNumber})">-</button>
            </form>
        `;
            } else {
                // If the seat is empty, just show the plus button
                if (card) card.classList.remove('expanded');
                seatDiv.innerHTML = `
            <button class="btn btn-success" onclick="addPerson(${seatNumber})">+</button>
        `;
            }

            // Add event listeners for changes
            const inputFields = seatDiv.querySelectorAll('input');
            inputFields.forEach(input => {
                input.addEventListener('change', function () {
                    hasChanges = true;
                });
            });
        };

        window.addPerson = function (seatNumber) {
            const seatDiv = document.getElementById(`seat${seatNumber}`);
            const card = seatDiv.closest('.card');
            if (card) card.classList.add('expanded');
            seatDiv.innerHTML = `
        <form>
            <div class="mb-2">
                <input type="text" class="form-control" placeholder="Name" name="name">
            </div>
            <div class="mb-2">
                <input type="text" class="form-control" placeholder="ID" name="id">
            </div>
            <div class="mb-2">
                <input type="text" class="form-control" placeholder="Department" name="department">
            </div>
            <div class="mb-2">
                <input type="text" class="form-control" placeholder="Batch" name="batch">
            </div>
            <button type="button" class="btn btn-danger" onclick="removePerson(${seatNumber})">-</button>
        </form>
    `;

            // Add event listener for input changes
            const inputFields = seatDiv.querySelectorAll('input');
            inputFields.forEach(input => {
                input.addEventListener('change', function () {
                    hasChanges = true;
                });
            });

            // Mark that changes have been made
            hasChanges = true;
        };
        window.removePerson = function (seatNumber) {
            const seatDiv = document.getElementById(`seat${seatNumber}`);
            const card = seatDiv.closest('.card');
            const form = seatDiv.querySelector('form');

            // Only mark changes if a form was actually removed
            if (form) {
                hasChanges = true;
            }

            if (card) card.classList.remove('expanded');
            seatDiv.innerHTML = `
        <button class="btn btn-success" onclick="addPerson(${seatNumber})">+</button>
    `;
        };

        // Keep submit button functionality
        document.querySelector('.mt-4 .btn-primary').addEventListener('click', async function () {
            if (!currentFloor || !currentRoom) {
                alert("Please filter a room first before submitting changes");
                return;
            }
            if (!hasChanges) {
                alert("No changes detected");
                return;
            }

            // Show saving indicator
            this.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Saving...';
            this.disabled = true;

            try {
                const roomId = `${currentFloor}${currentRoom}`;
                const seatUpdates = [];
                for (let seatNum = 1; seatNum <= 6; seatNum++) {
                    const seatDiv = document.getElementById(`seat${seatNum}`);
                    const form = seatDiv.querySelector('form');
                    const seatId = `seat${seatNum}`;
                    if (form) {
                        const nameInput = form.querySelector('input[name="name"]');
                        const idInput = form.querySelector('input[name="id"]');
                        const departmentInput = form.querySelector('input[name="department"]');
                        const batchInput = form.querySelector('input[name="batch"]');
                        const studentData = {
                            name: nameInput ? nameInput.value.trim() : '',
                            id: idInput ? idInput.value.trim() : '',
                            department: departmentInput ? departmentInput.value.trim() : '',
                            batch: batchInput ? batchInput.value.trim() : ''
                        };
                        if (!studentData.id) {
                            alert(`Please enter ID for Seat ${seatNum}`);
                            this.innerHTML = 'Submit';
                            this.disabled = false;
                            return;
                        }
                        seatUpdates.push({
                            seatId,
                            data: studentData,
                            isEmpty: false
                        });
                    } else {
                        seatUpdates.push({
                            seatId,
                            isEmpty: true
                        });
                    }
                }

                // Delete data from cache to force refresh
                delete roomExistsCache[roomId];
                delete roomSeatStatusCache[roomId];

                await setDoc(doc(db, "room", roomId), {
                    floor: currentFloor,
                    roomNumber: currentRoom,
                    lastUpdated: new Date()
                }, { merge: true });

                // Update all seats in batch
                const updatePromises = seatUpdates.map(update => {
                    const seatDocRef = doc(db, "room", roomId, "members", update.seatId);
                    if (update.isEmpty) {
                        return setDoc(seatDocRef, {
                            name: "",
                            id: "",
                            department: "",
                            batch: "",
                            isEmpty: true
                        });
                    } else {
                        return setDoc(seatDocRef, {
                            ...update.data,
                            isEmpty: false,
                            lastUpdated: new Date()
                        });
                    }
                });

                await Promise.all(updatePromises);

                alert("Room data saved successfully!");
                hasChanges = false;

                // Refresh room data for next viewing
                roomData = null; // Force reload next time the info is viewed

                // Reset button
                this.innerHTML = 'Submit';
                this.disabled = false;
            } catch (error) {
                console.error("Error saving room data:", error);
                alert("Failed to save room data: " + error.message);

                // Reset button
                this.innerHTML = 'Submit';
                this.disabled = false;
            }
        });
    </script>
</body>

</html>